{% extends "admin/base.html" %}
{% load static %}

{% block title %}Tableau de bord - Administration{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Tableau de bord - Cabinet d'Avocat</h1>
        <p>Bienvenue dans votre interface d'administration personnalisée</p>
    </div>
    
    <!-- Statistiques générales -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_services }}</h3>
                <p>Services actifs</p>
                <a href="{% url 'admin:website_service_changelist' %}" class="stat-link">Voir tous</a>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_avocats }}</h3>
                <p>Avocats</p>
                <a href="{% url 'admin:website_avocat_changelist' %}" class="stat-link">Voir tous</a>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-envelope"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_messages }}</h3>
                <p>Messages reçus</p>
                <a href="{% url 'admin:website_contactmessage_changelist' %}" class="stat-link">Voir tous</a>
            </div>
        </div>
        
        <div class="stat-card urgent">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.messages_non_traites }}</h3>
                <p>Messages non traités</p>
                <a href="{% url 'admin:website_contactmessage_changelist' %}?traite__exact=0" class="stat-link">Traiter</a>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_articles }}</h3>
                <p>Articles publiés</p>
                <a href="{% url 'admin:website_article_changelist' %}" class="stat-link">Voir tous</a>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_temoignages }}</h3>
                <p>Témoignages approuvés</p>
                <a href="{% url 'admin:website_témoignage_changelist' %}" class="stat-link">Voir tous</a>
            </div>
        </div>
    </div>
    
    <!-- Contenu principal -->
    <div class="dashboard-content">
        <div class="dashboard-left">
            <!-- Messages récents -->
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h2><i class="fas fa-envelope"></i> Messages récents</h2>
                    <a href="{% url 'admin:website_contactmessage_changelist' %}" class="widget-link">Voir tous</a>
                </div>
                {% if messages_recents %}
                    <div class="messages-list">
                        {% for message in messages_recents %}
                            <div class="message-item {% if not message.traite %}non-traite{% endif %}">
                                <div class="message-header">
                                    <div class="message-info">
                                        <strong>{{ message.nom }}</strong>
                                        <span class="message-email">{{ message.email }}</span>
                                    </div>
                                    <span class="message-date">{{ message.date_creation|date:"d/m/Y H:i" }}</span>
                                </div>
                                <div class="message-content">
                                    <p>{{ message.message|truncatewords:15 }}</p>
                                    {% if message.service %}
                                        <span class="message-service">{{ message.service.nom }}</span>
                                    {% endif %}
                                </div>
                                <div class="message-actions">
                                    <a href="{% url 'admin:website_contactmessage_change' message.id %}" class="btn btn-sm">Voir</a>
                                    {% if not message.traite %}
                                        <a href="mailto:{{ message.email }}" class="btn btn-sm btn-primary">Répondre</a>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>Aucun message récent</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Témoignages en attente -->
            {% if temoignages_en_attente %}
                <div class="dashboard-widget">
                    <div class="widget-header">
                        <h2><i class="fas fa-star"></i> Témoignages en attente</h2>
                        <a href="{% url 'admin:website_témoignage_changelist' %}?approuve__exact=0" class="widget-link">Voir tous</a>
                    </div>
                    <div class="temoignages-list">
                        {% for temoignage in temoignages_en_attente %}
                            <div class="temoignage-item">
                                <div class="temoignage-header">
                                    <div class="temoignage-info">
                                        <strong>{{ temoignage.nom_client }}</strong>
                                        {% if temoignage.entreprise %}
                                            <span class="temoignage-entreprise">{{ temoignage.entreprise }}</span>
                                        {% endif %}
                                    </div>
                                    <span class="temoignage-note">
                                        {% for i in "12345" %}
                                            <i class="fas fa-star {% if forloop.counter <= temoignage.note %}filled{% endif %}"></i>
                                        {% endfor %}
                                    </span>
                                </div>
                                <div class="temoignage-content">
                                    <p>{{ temoignage.témoignage|truncatewords:20 }}</p>
                                </div>
                                <div class="temoignage-actions">
                                    <a href="{% url 'admin:website_témoignage_change' temoignage.id %}" class="btn btn-sm btn-success">Approuver</a>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div class="dashboard-right">
            <!-- Articles récents -->
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h2><i class="fas fa-newspaper"></i> Articles récents</h2>
                    <a href="{% url 'admin:website_article_changelist' %}" class="widget-link">Voir tous</a>
                </div>
                {% if articles_recents %}
                    <div class="articles-list">
                        {% for article in articles_recents %}
                            <div class="article-item">
                                <h4>{{ article.titre }}</h4>
                                <p>{{ article.resume|truncatewords:15 }}</p>
                                <div class="article-meta">
                                    <span><i class="fas fa-user"></i> {{ article.auteur.nom|default:"Anonyme" }}</span>
                                    <span><i class="fas fa-calendar"></i> {{ article.date_publication|date:"d/m/Y" }}</span>
                                </div>
                                <a href="{% url 'admin:website_article_change' article.id %}" class="btn btn-sm">Modifier</a>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="fas fa-newspaper"></i>
                        <p>Aucun article récent</p>
                        <a href="{% url 'admin:website_article_add' %}" class="btn btn-primary">Créer un article</a>
                    </div>
                {% endif %}
            </div>
            
            <!-- Actions rapides -->
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h2><i class="fas fa-bolt"></i> Actions rapides</h2>
                </div>
                <div class="quick-actions">
                    <a href="{% url 'admin:website_contactmessage_changelist' %}" class="action-button">
                        <i class="fas fa-envelope"></i>
                        <span>Gérer les messages</span>
                    </a>
                    <a href="{% url 'admin:website_témoignage_changelist' %}" class="action-button">
                        <i class="fas fa-star"></i>
                        <span>Approuver témoignages</span>
                    </a>
                    <a href="{% url 'admin:website_article_add' %}" class="action-button">
                        <i class="fas fa-plus"></i>
                        <span>Nouvel article</span>
                    </a>
                    <a href="{% url 'admin:website_cabinetinfo_changelist' %}" class="action-button">
                        <i class="fas fa-cog"></i>
                        <span>Paramètres</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.dashboard {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 3rem;
}

.dashboard-header h1 {
    color: var(--secondary-color);
    margin-bottom: 0.5rem;
    font-size: 2.5rem;
    font-weight: 700;
}

.dashboard-header p {
    color: var(--text-light);
    font-size: 1.1rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    border-left: 4px solid var(--primary-color);
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-hover);
}

.stat-card.urgent {
    border-left-color: var(--warning-color);
}

.stat-icon {
    width: 60px;
    height: 60px;
    background: var(--primary-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.8rem;
}

.stat-card.urgent .stat-icon {
    background: var(--warning-color);
}

.stat-content h3 {
    font-size: 2.5rem;
    margin: 0;
    color: var(--secondary-color);
    font-weight: 700;
}

.stat-content p {
    margin: 0.5rem 0;
    color: var(--text-light);
    font-size: 1rem;
}

.stat-link {
    color: var(--primary-color);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
}

.stat-link:hover {
    text-decoration: underline;
}

.dashboard-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
}

.dashboard-widget {
    background: white;
    border-radius: 15px;
    box-shadow: var(--shadow);
    overflow: hidden;
    margin-bottom: 2rem;
}

.widget-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.widget-header h2 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.widget-link {
    color: white;
    text-decoration: none;
    font-size: 0.9rem;
    opacity: 0.9;
}

.widget-link:hover {
    opacity: 1;
    text-decoration: underline;
}

.messages-list, .temoignages-list, .articles-list {
    padding: 1.5rem;
}

.message-item, .temoignage-item, .article-item {
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    background: var(--light-bg);
    transition: all 0.3s ease;
}

.message-item:hover, .temoignage-item:hover, .article-item:hover {
    box-shadow: var(--shadow);
}

.message-item.non-traite {
    border-left: 4px solid var(--warning-color);
    background: #fff3cd;
}

.message-header, .temoignage-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.message-info, .temoignage-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.message-email, .temoignage-entreprise {
    color: var(--text-light);
    font-size: 0.9rem;
}

.message-date {
    color: var(--text-light);
    font-size: 0.9rem;
}

.message-content p, .temoignage-content p, .article-item p {
    margin: 0 0 1rem 0;
    color: var(--text-color);
    line-height: 1.6;
}

.message-service {
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    display: inline-block;
}

.temoignage-note .fas.fa-star.filled {
    color: var(--warning-color);
}

.article-item h4 {
    color: var(--secondary-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.article-meta {
    display: flex;
    gap: 1rem;
    color: var(--text-light);
    font-size: 0.9rem;
    margin: 0.75rem 0;
}

.article-meta span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.message-actions, .temoignage-actions {
    display: flex;
    gap: 0.5rem;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.8rem;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
    color: white;
}

.btn-success {
    background: var(--success-color);
    color: white;
}

.btn-success:hover {
    background: #1e7e34;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.quick-actions {
    padding: 1.5rem;
    display: grid;
    gap: 1rem;
}

.action-button {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--light-bg);
    color: var(--text-color);
    text-decoration: none;
    border-radius: 10px;
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
}

.action-button:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.action-button i {
    font-size: 1.2rem;
    width: 20px;
    text-align: center;
}

.empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
    color: var(--text-light);
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state p {
    margin-bottom: 1rem;
}

/* Responsive */
@media (max-width: 768px) {
    .dashboard {
        padding: 1rem;
    }
    
    .dashboard-content {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .widget-header {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dashboard-widget {
    animation: fadeInUp 0.6s ease;
}

.stat-card {
    animation: fadeInUp 0.6s ease;
}
</style>
{% endblock %}
